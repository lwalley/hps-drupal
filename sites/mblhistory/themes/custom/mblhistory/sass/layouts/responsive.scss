/**
 * @file
 * Positioning for responsive layout.
 *
 * Uses the Zen Grids plugin for Compass: http://zengrids.com
 */

@import "base";

//
// Default settings for all layouts.
//
// @note Mobile first approach so by default we have styles specific to mobile phones, basically
//       anything with a max-width < 480px. We start with a 3 column zen grid and mostly we have a
//       single column layout.
// @note zen-nested-container() must come after zen-grid-item().

// Float blockquote to right of paragraph - assumes multi-column layout.
@mixin mblhistory-blockquote-float() {
  .panel {
    @include zen-nested-container;
  }
  .view-content > div {
    > p {
      &:first-child {
        @include zen-grid-item-base();
        @include zen-grid-item(7, 1);
      }
    }
  }
  blockquote {
    @include zen-grid-item-base();
    @include zen-grid-item(4, 9);
    margin-top: 0;
    p {
      &:first-child {
        &:before {
          left: rhythm(0.2) * -1;
          top: rhythm(0.05);
        }
      }
    }
  }
}

// Default responsive widths for image styles defined in hps_defaults feature.
// @see modules/custom/hps_defaults
span.hpszen-responsive {
  &.hps-original,
  &.hps-principal,
  &.hps-supplemental,
  &.hps-minor,
  &.hps-uniform {
    display: inline-block;
    img {
      max-width: 100%;
    }
  }
}
@mixin hpszen-adjust-responsive-images($adjustment, $base: 12) {
  span.hpszen-responsive {
    &.hps-original {
      width: (1em / $base) * 350 * $adjustment;
    }
    &.hps-principal {
      width: (1em / $base) * 350 * $adjustment;
    }
    &.hps-supplemental {
      width: (1em / $base) * 200 * $adjustment;
    }
    &.hps-minor {
      width: (1em / $base) * 150 * $adjustment;
    }
    &.hps-uniform {
      width: (1em / $base) * 200 * $adjustment;
    }
  }
}
@include hpszen-adjust-responsive-images(1);

// Increase default base font size so that 1em == 12px
@include hpszen-increase-base-font-sizes(1.2);

iframe {
  display: block;
}
.submitted {
  @include hpszen-adjust-font-size-and-rhythm(0.9);
}
.pane-content {
  article {
    p {
      &:nth-of-type(1) {
        margin-top: 0;
      }
    }
  }
}

.section,
#content > .block,
#content > .node:first-child,
#content > .profile:first-child,
#content > dl:first-child,
#content > iframe:first-child,
#content > form:first-child {
  @include zen-grid-container();
}

#header {
  .section {
    position: relative;
    @include padding-leader(3); // Need space for secondary menu to slot into.
  }
  #brand,
  #secondary-menu,
  .region-header {
    @include zen-grid-item-base();
    @include zen-grid-item($zen-column-count, 1);
  }
  .region-header {
    @include zen-clear();
  }
  .views-exposed-form {
    overflow: hidden;
    @include padding-leader;
    @include padding-trailer;
    form {
      float: right;
    }
    input[type="text"] {
      width: rhythm(6);
    }
    input[type="submit"] {
      margin: 0;
    }
    label,
    .description {
      @include element-invisible();
    }
  }
}
// Region: page-top toolbar
// When logged admin toolbar needs some room.
// @todo toolbar can vary in height, this is the max it needs but will look rubbish with shorter toolbar
//       fix it with different styles, or maybe switch to single /admin menu item.
.toolbar {
  #header
    .section {
    @include padding-leader(3.8);
  }
}

#navigation {
  z-index: 98;
  .region-navigation {
    @include zen-grid-item-base();
    @include zen-clear();
    @include zen-grid-item($zen-column-count, 1);
    @include zen-nested-container();
  }
  a {
    padding-left: rhythm(1);
    padding-right: rhythm(1);
    display: block;
  }
  h2 {
    margin: rhythm(0.5) 0;
    overflow: hidden;
    a {
      float: right;
      padding: 0;
      margin: 0 rhythm(0.5);
    }
  }
  ul {
    margin: 0;
    padding: 0;
  }
  li {
    &.expanded {
      position: relative;
      > a {
        margin-right: rhythm(2);
        &.submenu-toggle {
          margin-right: 0;
          text-align: center;
          width: rhythm(1);
          position: absolute;
          right: 0;
        }
      }
    }
  }
}

// #main apply base grid and gutters to elements in #main
#main {
  .section-inner {
    @include zen-grid-item-base();
    @include zen-grid-item($zen-column-count, 1);
    @include zen-clear;
  }
}
#content {
  @include padding-trailer(1);
}
.breadcrumb {
  @include padding-leader(0.5);
  @include padding-trailer(0.5);
}
#block-sharethis-sharethis-block {
  @include padding-leader(1);
  @include padding-trailer(1);
}

#bottom,
#footer {
  clear: both;
  .block {
    @include zen-grid-item-base();
    @include zen-clear();
    @include zen-grid-item($zen-column-count, 1);
  }
}
#bottom {
  @include padding-leader();
  @include padding-trailer();
  li {
    display: inline;
  }
}
#footer {
  ul.menu {
    @include delimited-list('|');
    @include adjust-leading-to(3);
    a {
      padding: rhythm(1);
    }
    li {
      &:first-child {
        a {
          padding-left: 0;
        }
      }
    }
  }
  .block {
    &:last-child {
      text-transform: uppercase;
      @include hpszen-adjust-font-size-and-rhythm(0.9);
      p {
        margin: 0;
        + ul {
          @include delimited-list('|');
        }
      }
      address {
        display: inline;
        padding-right: rhythm(1);
      }
      li {
        &:last-child {
          padding-left: rhythm(1);
          letter-spacing: hpszen-px-to-em(1, 10);
        }
      }
    }
  }
}

#introduction,
#featured,
#basic,
#results {
  @include padding-leader();
  @include padding-trailer();
  .panel {
    @include zen-clear();
    @include zen-grid-item-base();
    @include zen-grid-item(12, 1);
  }
}
#introduction,
#featured {
  blockquote {
    @include mblhistory-blockquote();
    p {
      &:first-child {
        font-family: $font-fancy;
        font-style: italic;
        &:before {
          font-style: normal;
        }
      }
    }
  }
}
#panel-hpszen-r2 {
  .pane-views-row {
    .pane-content {
      > div {
        @include padding-leader(0.5);
        @include padding-trailer(0.5);
        border-bottom: 1px dotted darken(white, 30%);
        &:first-child {
          border-top: 1px dotted darken(white, 30%);
        }
      }
    }
  }
}
#results {
  .pane-views-exposed {
    padding: rhythm(1);
    .views-submit-button {
      clear: both;
      float: right;
      input {
        margin-top: 0;
      }
    }
  }
}
#results,
#featured {
  .views-widget-filter-search_api_views_fulltext {
    label {
      @include element-invisible();
    }
    input {
      @include margin-leader;
    }
  }
}
#basic {
  .pane-title {
    margin-bottom: 0;
  }
}
.page-mblhistory-home {
  #panel-hpszen-b1,
  #panel-hpszen-b2 {
    ul {
      list-style-type: none;
      padding-left: 0;
      li {
        @include padding-leader(0.5);
        @include padding-trailer(0.5);
        border-bottom: 1px dotted darken(white, 30%);
        overflow: hidden;
        &:first-child {
          border-top: 1px dotted darken(white, 30%);
        }
        > h3 {
          @include hpszen-adjust-font-size-and-rhythm(1);
          margin: 0;
        }
        > p {
          @include hpszen-adjust-font-size-and-rhythm(0.9);
          @include margin-leader(0.5);
          @include margin-trailer(0.5);
          &:last-child {
            @include hpszen-adjust-font-size-and-rhythm(0.8);
            margin-top: 0;
            margin-bottom: 0;
          }
        }
        > a {
          width: 30%;
          margin-right: 2%;
          display: block;
          float: left;
          .hpszen-responsive {
            max-width: 100%;
          }
          + h3 {
            margin-left: 32%;
          }
        }
        > span {
          display: block;
          float: right;
        }
      }
    }
  }
}
// Override default layout for different site sections
.page-taxonomy-term {
  #introduction {
    padding-top: 0;
    .pane-term-description {
      .pane-content {
        p {
          &:first-child {
            margin-top: 0;
          }
        }
      }
    }
  }
}
.page-mblhistory-build-the-archives {
  #featured {
    @include padding-leader;
    @include padding-trailer(2);
    .view-content > div {
      float: left;
      @include padding-leader(1);
      padding-right: rhythm(1);
    }
    h3 {
      @include element-invisible();
    }
    .hpszen-responsive.hps-uniform {
      width: hpszen-px-to-em(80, 12);
    }
  }
  #panel-hpszen-b1 {
    .pane-hps-archives-panel-pane-hps-archives-featured-stories {
      @include zen-clear();
      @include zen-grid-item-base();
      @include zen-grid-item(12, 1);
      @include zen-nested-container();
      ul {
        list-style-type: none;
        padding-left: 0;
        li {
          @include padding-leader();
          @include padding-trailer();
          border-bottom: 1px dotted darken(white, 30%);
          overflow: hidden;
          &:first-child {
            border-top: 1px dotted darken(white, 30%);
          }
          .hpszen-responsive {
            @include zen-grid-item-base();
            @include zen-grid-item(4, 1);
            @include zen-clear();
          }
          > div {
            @include zen-grid-item-base();
            @include zen-grid-item(8, 5);
            h3 {
              margin: 0;
              + p {
                margin-top: rhythm(0.2);
              }
            }
          }
        }
      }
    }
  }
}
.page-mblhistory-explore {
  #featured {
    padding-bottom: 0;
  }
  #panel-hpszen-b2 {
    blockquote {
      @include mblhistory-blockquote();
    }
  }
  .pane-hps-courses-search {
    ul {
      @include hpszen-bulletless-list;
    }
    li {
      display: inline;
    }
  }
}
.page-hps-archives {
  #featured {
    h2 {
      @include hpszen-adjust-font-size-and-rhythm(1.1);
    }
    ul {
      @include hpszen-bulletless-list;
      @include adjust-leading-to(1);
    }
  }
}
.node-type-hps-course {
  .pane-hps-courses-panel-pane-course-participants {
    @include zen-nested-container();
    .view-empty {
      @include zen-grid-item-base();
      @include zen-grid-item(12, 1);
    }
    .group {
      @include zen-grid-item-base();
      &:nth-child(2n+1) {
        @include zen-grid-item(6, 1);
        @include zen-clear();
      }
      &:nth-child(2n) {
        @include zen-grid-item(6, 7);
      }
    }
    ul {
      @include hpszen-bulletless-list;
    }
  }
}

// Start of overrides for wider screens
// Font: increase base font size as screens get wider
// Content increase base grid and gutters
@media all and (min-width: 1em / 16 * 481) and (max-width: 1em / 16 * 1023) {
  //@include hpszen-adjust-base-gutter(2);
  @include hpszen-increase-base-font-sizes(1.3);
  @include hpszen-adjust-responsive-images(1.5, 13);
}
@media all and (min-width: 1em / 16 * 961) {
  .section {
    margin: 0 auto;
    max-width:  hpszen-px-to-em($hpszen-max-content-width, 13); // base font size increased by 1.3 to 13px between 961 and 1023 screen widths
  }
  #content {
    > .block,
    > .node:first-child,
    > .profile:first-child,
    > dl:first-child,
    > iframe:first-child,
    > form:first-child {
      margin: 0 auto;
      max-width:  hpszen-px-to-em($hpszen-max-content-width - 60, 13); // Add gutters to align lone content blocks and nodes
    }
  }
  #header {
    // Make header section a little wider than the rest of the content
    .section {
      max-width: hpszen-px-to-em($hpszen-max-content-width + 30, 13);
    }
  }
}
@media all and (min-width: 1em / 16 * 1024) {
  @include hpszen-increase-base-font-sizes(1.4);
  @include hpszen-adjust-responsive-images(2, 13);
  .section {
    max-width: hpszen-px-to-em($hpszen-max-content-width, 14); // 14px is base font size at this screen width
  }
  #navigation {
    .section {
      max-width: hpszen-px-to-em($hpszen-max-content-width - 15, 14);
    }
  }
  #content {
    > .block,
    > .node:first-child,
    > .profile:first-child,
    > dl:first-child,
    > iframe:first-child,
    > form:first-child {
      max-width: hpszen-px-to-em($hpszen-max-content-width - 60, 14); // Add gutters to align lone content nodes and blocks
    }
  }
  #header {
    // Make header section a little wider than the rest of the content to give seal some room
    .section {
      max-width: hpszen-px-to-em($hpszen-max-content-width + 60, 14);
      #logo,
      #name-and-slogan {
        margin-left: hpszen-px-to-em(25, 14);
      }
      #logo {
        @include leader;
      }
    }
  }
}

// Multi-column layouts.
@media all and (min-width: 1em / 16 * 768) {
  #header {
    #brand {
      @include zen-grid-item(7, 1);
    }
    .region-header,
    #secondary-menu {
      @include zen-grid-item(5, 8);
    }
    .region-header {
      clear: none;
    }
    .section {
      padding-bottom: rhythm(1);
    }
  }
  .hpszen-i1-f1-b2,
  .hpszen-i1-f2-b2 {
    #panel-hpszen-b1 {
      @include zen-grid-item(6, 1);
    }
    #panel-hpszen-b2 {
      @include zen-grid-item(6, 7);
      clear: none;
    }
  }
  .hpszen-i1-f1-b3,
  .hpszen-i1-f2-b3 {
    #panel-hpszen-b1 {
      @include zen-grid-item(4, 1);
    }
    #panel-hpszen-b2 {
      @include zen-grid-item(4, 5);
      clear: none;
    }
    #panel-hpszen-b3 {
      @include zen-grid-item(4, 9);
      clear: none;
    }
  }
  .hpszen-i1-f2-b2,
  .hpszen-i1-f2-b3 {
    #panel-hpszen-f1 {
      @include zen-grid-item(8, 1);
    }
    #panel-hpszen-f2 {
      @include zen-grid-item(4, 9);
      clear: none;
    }
  }
  .hpszen-i1-b2 {
    #panel-hpszen-b1 {
      @include zen-grid-item(3, 1);
    }
    #panel-hpszen-b2 {
      @include zen-grid-item(9, 4);
      clear: none;
    }
  }
  .hpszen-i1-b3 {
    #panel-hpszen-b1 {
      @include zen-grid-item(3, 1);
    }
    #panel-hpszen-b2 {
      @include zen-grid-item(6, 4);
      clear: none;
    }
    #panel-hpszen-b3 {
      @include zen-grid-item(3, 10);
      clear: none;
    }
  }
  .hpszen-i1-r2 {
    #panel-hpszen-r1 {
      @include zen-grid-item(4, 1);
      .panel-pane {
        input[type="text"] {
          width: 100%;
        }
        .views-submit-button {
          clear: both;
        }
      }
    }
    #panel-hpszen-r2 {
      @include zen-grid-item(8, 5);
      clear: none;
    }
  }
  #footer {
    .block {
      &:last-child {
        p {
          float: left;
          + ul {
            float: right;
          }
        }
      }
    }
  }
  .page-hps-archives {
    #featured {
      .panel {
        @include zen-nested-container();
        .panel-pane {
          @include zen-grid-item-base();
          @include zen-grid-item(12, 1);
          @include zen-clear();
          &:nth-of-type(2) {
            @include zen-grid-item(4, 1);
          }
          &:last-child {
            @include zen-grid-item(4, 5);
            clear: none;
          }
        }
      }
    }
  }
  .page-mblhistory-home {
    #featured {
      @include padding-leader();
    }
    &.hpszen-i1-f2-b3 {
      #panel-hpszen-f1 {
        @include zen-grid-item(4, 9);
        clear: none;
      }
      #panel-hpszen-f2 {
        @include zen-grid-item(8, 1);
      }
    }
    #panel-hpszen-b1,
    #panel-hpszen-b2 {
      ul {
        li {
          a {
            width: 30%;
            margin-right: 0;
            + h3 {
              margin-left: 30%;
              padding-left: rhythm(0.5);
              + p {
                clear: both;
              }
            }
          }
        }
      }
    }
    #bottom {
      p {
        @include zen-grid-item(4, 1);
      }
      ul {
        @include zen-grid-item(8, 5);
      }
    }
  }
  .page-mblhistory-build-the-archives {
    &.hpszen-i1-f2-b2,
    &.hpszen-i1-f2-b3 {
      #panel-hpszen-f1 {
        @include zen-grid-item(7, 1);
      }
      #panel-hpszen-f2 {
        @include zen-grid-item(5, 8);
      }
    }
  }
  .node-type-hps-news {
    .node-hps-news {
      overflow: hidden;
      .group_hps_news_image {
        @include hpszen-adjust-font-size-and-rhythm(0.9);
        width: 40%;
        float: right;
        .hpszen-responsive {
          width: 100%;
          @include padding-trailer(0.5);
        }
        + div {
          margin-right: 40%;
          padding-right: rhythm(2);
        }
      }
    }
  }
}

// Navigation: switch to horizontal nav for wider screens.
// Must match the js threshold for horizontal menu
// @see js/script.js
@media all and (min-width: 1em / 16 * 699) {
  // Convert main menu to horizontal bar.
  #navigation {
    .block-menu .block-title,
    .block-menu-block .block-title {
      @include element-invisible;
    }
    .block-menu {
      > ul {
        float: left;
        > li {
          float: left;
          list-style-position: inside;
          margin-right: rhythm(1);
          &:last-child {
            margin-right: 0;
          }
          > a {
            @include padding-leader(0.5);
            @include padding-trailer(0.5);
          }
        }
      }
    }
  }
}

// Content: asides adjacent to content
@media all and (min-width: 1em / 16 * 768) {
  .pane-hps-browse-panel-pane-list {
    .views-row {
      span.hpszen-responsive {
        clear: both;
        float: left;
        padding-right: rhythm(1);
        width: 50%;
      }
    }
  }
}

// Content: More whitespace needed for wider screens.
// @todo it would be better if we could reset gutter width and reapply grid

// Messages icons need some room, so we override grid padding
#main {
  .messages {
    padding-left: 50px !important;
  }
}

